

<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">
                    <i class="fas fa-prescription-bottle-alt me-2"></i>
                    Create Prescription
                </h4>
            </div>
            <div class="card-body p-4">
                <!-- Appointment Summary -->
                <div class="alert alert-info">
                    <h6 class="alert-heading">
                        <i class="fas fa-info-circle me-2"></i>
                        Appointment Details
                    </h6>
                    <div class="row">
                        <div class="col-sm-6">
                            <strong>Patient:</strong> <%= appointment.patientName %><br>
                            <strong>Date:</strong> <%= appointment.appointmentDate.toLocaleDateString() %>
                        </div>
                        <div class="col-sm-6">
                            <strong>Time:</strong> <%= appointment.appointmentDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %><br>
                            <strong>Status:</strong> 
                            <span class="badge bg-success">
                                <i class="fas fa-check-double me-1"></i>
                                <%= appointment.status %>
                            </span>
                        </div>
                    </div>
                    <hr class="my-2">
                    <div>
                        <strong>Health Concern:</strong> <%= appointment.healthConcern %>
                    </div>
                </div>

                <form method="POST" action="/prescriptions/create/<%= appointment.id %>">
                    <div class="mb-3">
                        <label for="medicineName" class="form-label">
                            <i class="fas fa-pills me-1"></i>
                            Medicine Name(s) <span class="text-danger">*</span>
                        </label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="medicineName" 
                            name="medicineName" 
                            required
                            minlength="2"
                            maxlength="100"
                            placeholder="e.g., Paracetamol 500mg, Amoxicillin 250mg"
                        >
                        <div class="form-text">
                            Enter the complete medicine name(s) with strength/dosage form
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="dosage" class="form-label">
                            <i class="fas fa-weight me-1"></i>
                            Dosage Instructions <span class="text-danger">*</span>
                        </label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="dosage" 
                            name="dosage" 
                            required
                            minlength="2"
                            maxlength="100"
                            placeholder="e.g., 1 tablet, 2 capsules, 5ml syrup"
                        >
                        <div class="form-text">
                            Specify the amount to be taken per dose
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="frequency" class="form-label">
                            <i class="fas fa-clock me-1"></i>
                            Frequency of Administration <span class="text-danger">*</span>
                        </label>
                        <select class="form-select" id="frequency" name="frequency" required>
                            <option value="">Select frequency...</option>
                            <option value="Once daily">Once daily</option>
                            <option value="Twice daily">Twice daily</option>
                            <option value="Three times daily">Three times daily</option>
                            <option value="Four times daily">Four times daily</option>
                            <option value="Every 4 hours">Every 4 hours</option>
                            <option value="Every 6 hours">Every 6 hours</option>
                            <option value="Every 8 hours">Every 8 hours</option>
                            <option value="Every 12 hours">Every 12 hours</option>
                            <option value="Before meals">Before meals</option>
                            <option value="After meals">After meals</option>
                            <option value="With meals">With meals</option>
                            <option value="At bedtime">At bedtime</option>
                            <option value="As needed">As needed (PRN)</option>
                        </select>
                        <div class="form-text">
                            Choose how often the medicine should be taken
                        </div>
                    </div>

                    <!-- Custom frequency input -->
                    <div class="mb-3" id="customFrequency" style="display: none;">
                        <label for="customFrequencyText" class="form-label">
                            <i class="fas fa-edit me-1"></i>
                            Custom Frequency
                        </label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="customFrequencyText" 
                            name="customFrequencyText" 
                            maxlength="100"
                            placeholder="Enter custom frequency instructions"
                        >
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="fas fa-prescription-bottle-alt me-2"></i>
                            Create Prescription
                        </button>
                        
                        <a href="/appointments/my-appointments" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>
                            Back to My Appointments
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Prescription Guidelines -->
        <div class="card mt-4 border-warning">
            <div class="card-header bg-warning text-dark">
                <h6 class="mb-0">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Prescription Guidelines
                </h6>
            </div>
            <div class="card-body">
                <ul class="mb-0">
                    <li>Be specific with medicine names and strengths</li>
                    <li>Include clear dosage instructions</li>
                    <li>Specify frequency and timing clearly</li>
                    <li>Consider patient's medical history and allergies</li>
                    <li>Ensure prescription is legible and complete</li>
                    <li>Review for potential drug interactions</li>
                </ul>
            </div>
        </div>

        <!-- Common Medicines Quick Reference -->
        <div class="card mt-4 border-info">
            <div class="card-header bg-info text-white">
                <h6 class="mb-0">
                    <i class="fas fa-book-medical me-2"></i>
                    Common Medicines Reference
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Pain Relief</h6>
                        <ul class="small">
                            <li>Paracetamol 500mg</li>
                            <li>Ibuprofen 400mg</li>
                            <li>Aspirin 325mg</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Antibiotics</h6>
                        <ul class="small">
                            <li>Amoxicillin 250mg</li>
                            <li>Azithromycin 500mg</li>
                            <li>Ciprofloxacin 500mg</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Handle custom frequency option
document.getElementById('frequency').addEventListener('change', function() {
    const customDiv = document.getElementById('customFrequency');
    const customInput = document.getElementById('customFrequencyText');
    
    if (this.value === 'custom') {
        customDiv.style.display = 'block';
        customInput.required = true;
    } else {
        customDiv.style.display = 'none';
        customInput.required = false;
        customInput.value = '';
    }
});

// Add custom option if not exists
document.addEventListener('DOMContentLoaded', function() {
    const frequencySelect = document.getElementById('frequency');
    const customOption = document.createElement('option');
    customOption.value = 'custom';
    customOption.textContent = 'Custom frequency...';
    frequencySelect.appendChild(customOption);
});

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const medicineName = document.getElementById('medicineName').value.trim();
    const dosage = document.getElementById('dosage').value.trim();
    const frequency = document.getElementById('frequency').value;
    const customFrequency = document.getElementById('customFrequencyText').value.trim();
    
    if (!medicineName || !dosage || !frequency) {
        e.preventDefault();
        alert('Please fill in all required fields.');
        return;
    }
    
    if (frequency === 'custom' && !customFrequency) {
        e.preventDefault();
        alert('Please enter custom frequency instructions.');
        return;
    }
    
    // Update frequency with custom value if selected
    if (frequency === 'custom') {
        const hiddenInput = document.createElement('input');
        hiddenInput.type = 'hidden';
        hiddenInput.name = 'frequency';
        hiddenInput.value = customFrequency;
        this.appendChild(hiddenInput);
        
        // Remove the select name to avoid duplicate submission
        document.getElementById('frequency').name = '';
    }
});
</script>
